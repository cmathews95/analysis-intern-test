select student_id, max(avg(grade)) from (
  select * from (
    select * from student_scores group by student_id having count(*) = 3
  ) where class in ('A', 'B', 'C')
) group by student_id;
